# -*- mode: makefile; -*-

# Makefile for the Non Sequencer.

#
# Do not edit this file; run `make config` instead.
#

VERSION := 1.9.4
PACKAGE := SEQUENCER
BIN_NAME := non-sequencer

all: Sequencer

SRCS := $(wildcard src/*.C src/*.fl src/gui/*.C src/gui/*.fl src/NSM/*.C)

SRCS:=$(SRCS:.fl=.C)
SRCS:=$(sort $(SRCS))
OBJS:=$(SRCS:.C=.o)

CFLAGS += $(CFLAGS) $(CXXFLAGS) $(FLTK_CFLAGS) $(SIGCPP_CFLAGS) $(LIBLO_CFLAGS) $(XPM_CFLAGS)

LIBS += $(FLTK_LDFLAGS) $(JACK_LIBS) $(SIGCPP_LIBS) $(LIBLO_LIBS) $(XPM_LIBS)

Sequencer: src/sequencer

clean:
	rm -f src/sequencer .deps $(OBJS)

src/sequencer: $(OBJS) FL/libfl_widgets.a nonlib/libnonlib.a $(FLTK_LIBS)
	@ echo -n Linking sequencer...
	@ $(CXX) $(CXXFLAGS) $(LIBS) $^ -o $@ -LFL -lfl_widgets -Lnonlib -lnonlib -ldl && echo $(DONE)


ifeq ($(JACK_MIDI_PROTO_API),yes)
	CXXFLAGS+=-DJACK_MIDI_PROTO_API
endif

install: all
	@ echo -n "Installing..."
	@ install -Dm755 src/sequencer "$(DESTDIR)$(prefix)"/bin/non-sequencer
	@ install -d "$(DESTDIR)$(SYSTEM_PATH)/instruments"
	@ install -m 644 instruments/* "$(DESTDIR)$(SYSTEM_PATH)/instruments"
	@ $(MAKE) -s -C doc install
	@ install -d "$(DESTDIR)$(PIXMAP_PATH)"
	@ install -m 644 icons/hicolor/256x256/apps/non-sequencer.png "$(DESTDIR)$(PIXMAP_PATH)"/icon-256x256.png
	@ install -d "$(DESTDIR)$(ICON_PATH)/hicolor"
	@ cp -au icons/hicolor/ "$(DESTDIR)$(ICON_PATH)"
	@ install -d "$(DESTDIR)$(DESKTOP_PATH)"
	@ sed 's:@BIN_PATH@:$(prefix)/bin:' non-sequencer.desktop.in > "$(DESTDIR)$(DESKTOP_PATH)/non-sequencer.desktop"
	@ echo "$(DONE)"
ifneq ($(USE_DEBUG),yes)
	@ echo -n "Stripping..."
	@ strip "$(DESTDIR)$(prefix)"/bin/non-sequencer
	@ echo "$(DONE)"
endif

