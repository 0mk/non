#!/bin/sh
#
# Copyright (C) 2008 Jonathan Moore Liles
# This file is licensed under version 2 of the GPL.

. scripts/config-funcs

begin

begin_options

ask "Installation prefix" prefix /usr/local
ask "Build for debugging" USE_DEBUG no

using DEBUG &&
{
    ask "Use unoptimized drawing routines" USE_UNOPTIMIZED_DRAWING no
    ask "Use widget for timeline" USE_WIDGET_FOR_TIMELINE no
    using WIDGET_FOR_TIMELINE || ask "Use singlebuffered timeline" USE_SINGLEBUFFERED_TIMELINE no
}

begin_tests

require_FLTK 1.1.7 images
require_command FLUID fluid
require_command ar ar
require_command makedepend makedepend
require_package JACK 0.103.0 jack
require_package sndfile 1.0.17 sndfile
require_package liblo 0.23 liblo
require_package sigcpp 2.0.0 sigc++-2.0
suggest_package XPM 2.0.0 xpm

if ! hostname_resolvable
then
    echo "Your hostname \"$(hostname)\" does not resolve to a valid address."
    echo "This is a broken configuration and will cause liblo (the"
    echo "OSC library) to fail to function. Add the line:"
    echo
    echo "127.0.0.1 $(hostname)"
    echo
    echo "to your /etc/hosts file to fix. And consider switching to a saner distribution."
    echo
    fail "Invalid hostname!"
fi

if ! test_version 1.1.10 $FLTK_VERSION 
then
    warn "*** PERFORMANCE WARNING ***"
    warn ""
    warn "Your FLTK version is $FLTK_VERSION."
    warn ""
    warn "FLTK version 1.3.0 introduced a bug which slows down the"
    warn "drawing of Non-DAW's timeline by a factor of thousands."
    warn ""
    warn "Install FLTK 1.1.10 and try again."
    warn ""
    warn "Alternatively, you can rerun configure and answer 'yes' to"
    warn "the question 'Use widget for timeline'. It will be fast, but"
    warn "you won't be able to see the playhead."
    warn ""
    warn "Please send any and all complaints to the FLTK developers!"
fi

test_version `version_of liblo` 0.26 || warn "Version $(version_of liblo) of liblo is slow to create servers. Consider upgrading to 0.26 or later"

end
